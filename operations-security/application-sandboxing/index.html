<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-operations-security/application-sandboxing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Application Sandboxing | Portfolio</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.harisqazi.com/img/blog_image.cleaned.jpeg"><meta data-rh="true" name="twitter:image" content="https://www.harisqazi.com/img/blog_image.cleaned.jpeg"><meta data-rh="true" property="og:url" content="https://www.harisqazi.com/operations-security/application-sandboxing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Application Sandboxing | Portfolio"><meta data-rh="true" name="description" content="Application Isolation in X11"><meta data-rh="true" property="og:description" content="Application Isolation in X11"><link data-rh="true" rel="icon" href="/img/HQ-Logo-Dark.png"><link data-rh="true" rel="canonical" href="https://www.harisqazi.com/operations-security/application-sandboxing"><link data-rh="true" rel="alternate" href="https://www.harisqazi.com/operations-security/application-sandboxing" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.harisqazi.com/operations-security/application-sandboxing" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Portfolio RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Portfolio Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Portfolio JSON Feed"><link rel="stylesheet" href="/assets/css/styles.03fad3ea.css">
<script src="/assets/js/runtime~main.54c31341.js" defer="defer"></script>
<script src="/assets/js/main.76b4cc88.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.harisqazi.com/" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/HQ-Logo-Light.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/HQ-Logo-Dark.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Haris Qazi</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Portfolio</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/harisqazi1/portfolio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/privacy">Privacy Policy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/configurations">Configurations</a><button aria-label="Expand sidebar category &#x27;Configurations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/category/operations-security-opsec">Operations Security (OPSEC)</a><button aria-label="Collapse sidebar category &#x27;Operations Security (OPSEC)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operations-security/basic-software-investigation">Basic Software Investigation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/operations-security/application-sandboxing">Application Sandboxing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operations-security/apparmor">AppArmor</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/open-source-intelligence-osint">Open-Source Intelligence (OSINT)</a><button aria-label="Expand sidebar category &#x27;Open-Source Intelligence (OSINT)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/red-team-operations">Red Team Operations</a><button aria-label="Expand sidebar category &#x27;Red Team Operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/operations-security-opsec"><span itemprop="name">Operations Security (OPSEC)</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Application Sandboxing</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Application Sandboxing</h1></header>
<p>I was recently thinking about finding mitigations to the lack of application isolation on X11. Applications run by the same user have the capability to &quot;log all keystrokes, tamper with other apps windows, steal the contents of copy/paste buffers, inject keystrokes into other windows, etc&quot;[2]. This led me to look into application sandboxing solutions for Linux. This blog post is my journey testing out sandboxing solutions.</p>
<p><strong>Author&#x27;s note</strong>: This blog post got large really fast. I had to cut down talking about other sandboxing solutions, as I was at 6500+ words discussing only the topic of sandboxing. Due to this, I plan to make MACs (originally planned for this blog post) into another blog post.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-environment">Testing Environment<a href="#testing-environment" class="hash-link" aria-label="Direct link to Testing Environment" title="Direct link to Testing Environment">​</a></h2>
<p>In order to test out the solutions, I will be using a virtual machine (VM). I try to spin up a test environment for every project I run, just so I don&#x27;t make any permanent changes to my system that I cannot undo. There is unfortunately no &quot;undo&quot; button for major changes on an OS. It is similar to how enterprises have test and production environments. With that being said, I have recently switched over to using KVM+QEMU instead of VirtualBox. I made this decision after reading the following page on the Whonix site: <a href="https://www.whonix.org/wiki/KVM#Why_Use_KVM_Over_VirtualBox?" target="_blank" rel="noopener noreferrer">https://www.whonix.org/wiki/KVM#Why_Use_KVM_Over_VirtualBox?</a> which resonated with me. In order to install KVM+QEMU on Ubuntu-based Linux you run:</p>
<p><code>sudo apt install qemu-kvm libvirt-clients libvirt-daemon-system bridge-utils virtinst libvirt-daemon virt-manager -y</code></p>
<p>This will install the apps and its dependencies. I have a cheatsheet <a href="https://github.com/harisqazi1/cheatsheets/blob/master/kvm" target="_blank" rel="noopener noreferrer">here</a> if you want more commands for running machines, etc. I used <a href="https://pop.system76.com/" target="_blank" rel="noopener noreferrer">Pop!_OS</a> for this post, and after moving the ISO to <code>/var/lib/libvirt/images/</code>, I ran the following command to install it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">virt-install --virt-type</span><span class="token operator">=</span><span class="token plain">kvm </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--name</span><span class="token plain"> PopOS </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--vcpus</span><span class="token operator">=</span><span class="token number">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--memory</span><span class="token operator">=</span><span class="token number">4096</span><span class="token plain"> --os-variant</span><span class="token operator">=</span><span class="token plain">popos20.04 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--cdrom</span><span class="token operator">=</span><span class="token plain">/var/lib/libvirt/images/pop-os_22.04_amd64_intel_43.iso  </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--network</span><span class="token operator">=</span><span class="token plain">default </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--disk</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">size</span><span class="token operator">=</span><span class="token number">40</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This command flags or options are self-explanatory, so I didn&#x27;t choose to spell them out here. After updating and upgrading the OS, I do run <code>sudo apt install openssh*</code> and <code>sudo ufw allow ssh</code> on the machine so I can SSH from my own system without having to access the GUI. The initial command (aforementioned in the code box above) should also pop open a screen into the VM as well, allowing you to see and interact with the VM. Here are the usual commands I use to interact with the machine:</p>
<ul>
<li>List all VMs: <code>virsh list --all</code></li>
<li>Start PopOS (or VM name): <code>virsh start PopOS</code></li>
<li>GUI view into a running VM: <code>virt-viewer --connect qemu:///system PopOS</code></li>
<li>Find IP Address of VM (for SSH): <code>virsh domifaddr --domain PopOS</code></li>
</ul>
<p>For shutting down the VM, I have not had success using <code>virsh shutdown PopOS</code>, so I run either <code>/sbin/shutdown</code> (user has permission for this) or <code>sudo shutdown now</code>.</p>
<p>You could also use the GUI application &quot;Virtual Machine Manager&quot; (<code>virt-manager</code>) to manage your VMs:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-11_15-03-a6a0ee12f77c902489daab83312735a6.png" width="941" height="530" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="x11">X11<a href="#x11" class="hash-link" aria-label="Direct link to X11" title="Direct link to X11">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-x11-gui-vulnerability">The X11 GUI &quot;Vulnerability&quot;<a href="#the-x11-gui-vulnerability" class="hash-link" aria-label="Direct link to The X11 GUI &quot;Vulnerability&quot;" title="Direct link to The X11 GUI &quot;Vulnerability&quot;">​</a></h3>
<p>On Linux, there are two popular display server (a.k.a windowing system) protocols: X11 and Wayland [6]. Wayland is the more modern display protocol that attempts to deal with GUI Isolation, although I could not locate specific Wayland documentation (from Wayland) that alludes to this being a featured feature. Unfortunately, the open source display server for the X11 windowing system: X.Org Server, does not provide application isolation [3,4,5,6]. This allows malicious apps ran on the X.Org Server to do the following: keylog, screenshot programs, record the screen, mess with other applications, etc. [3,4,5].</p>
<blockquote>
<p>Just a small aside for some synonyms for information going forward. X11: X and X Window System X.Org Server: X Server</p>
</blockquote>
<p>This is due to how the server is configured. See the following image:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/MAB7Y-f4ecb68f5d206b1230b7762b0338268b.png" width="640" height="375" class="img_ev3q"></p>
<p>Since multiple applications (X.org clients) are able to connect to the same X.Org server - and there is no isolation on the server, this allows the application to have the capabilities to spy on each other, and by extension, the user. According to an answer on StackExchange &quot;[T]here is isolation with X11 -- but it is between users (as controlled by the OS), not between applications executed on behalf of the same user&quot;[2]. Everything you do could be spied on: entering banking credentials, to the root password for your system, password manager credentials, cryptocurrency wallet information, etc. If you want to read more about this, I would highly recommend the following: <a href="https://security.stackexchange.com/questions/179851/do-any-non-gnu-linux-display-managers-provide-the-same-isolation-as-wayland" target="_blank" rel="noopener noreferrer">https://security.stackexchange.com/questions/179851/do-any-non-gnu-linux-display-managers-provide-the-same-isolation-as-wayland</a></p>
<blockquote>
<p>One thing to mention here is that apps that use the flatpak, Snap, etc. packages have their own sandboxing to some aspect. Thus, they might not be **as ** harmful when accessing the X.Org Server compared to apt,dnf,pacman, etc. installed packages.</p>
</blockquote>
<p>From a privacy and security standpoint, this is a big vulnerability to me. To mitigate this, I could just transition over to using <a href="https://wayland.freedesktop.org/" target="_blank" rel="noopener noreferrer">Wayland</a>. However, since Wayland is a newer technology, I wanted to give it time to be a bit more stable before officially switching to it. In addition, it is not default on NVIDIA-based Pop!_OS ISOs. I did also get issues when trying to switch from X11 to Wayland on Pop!_OS 22.04 LTS x86_64. This led me to learn about two sandboxing solutions for Linux: firejail and bubblejail. I also wanted to dive deeper into a couple package managers that work with sandboxing to some aspect: Flatpak and Snap. However before diving deeper into these, I wanted to replicate a PoC for this vulnerability.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x11-gui-vulnerability-exploit">X11 GUI &quot;Vulnerability&quot; Exploit<a href="#x11-gui-vulnerability-exploit" class="hash-link" aria-label="Direct link to X11 GUI &quot;Vulnerability&quot; Exploit" title="Direct link to X11 GUI &quot;Vulnerability&quot; Exploit">​</a></h3>
<p>I wanted to test out the lack of application isolation on X11, so this section is repeating a proof of concept (PoC) I saw on a <a href="https://wiki.gentoo.org/wiki/User:Sakaki/Sakaki&#x27;s_EFI_Install_Guide/Sandboxing_the_Firefox_Browser_with_Firejail#Demonstrating_the_X11_Vulnerability" target="_blank" rel="noopener noreferrer">Gentoo Wiki</a>. In order to exploit this vulnerability, you need the following packages: <code>gedit</code>, <code>xinput</code>, <code>x11-apps</code>, <code>graphicsmagick-imagemagick-compat</code>,and <code>eog</code> (or any image viewer). On Debian-based systems, this can be downloaded with <code>sudo apt install gedit xinput x11-apps eog graphicsmagick-imagemagick-compat</code>.</p>
<p>The following steps I will list below:</p>
<ol>
<li>As root (<code>sudo su -</code>) run <code>gedit /root/secret_passwords.txt</code></li>
<li>Run <code>xinput --list</code> to see list of peripherals to your PC and note the <strong>id</strong> of your keyboard. This will <strong>not</strong> be a pointer device, but a keyboard device (NOTE: If you see multiple options for your keyboard, you might have to play around with it in step 3, to see which one is showing results. The output should say &quot;key press XY&quot; or &quot;key release XY&quot; when you press keys on your keyboard.)</li>
<li>Run <code>xinput test XY</code>, replacing XY with your id from the previous step</li>
<li>You should see output when you press a key on your keyboard</li>
</ol>
<p>The values that xinput provides seem to have a shift of 8-9 compared to the output from <code>evtest</code> (which is accurate):</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-11_13-59-2cfae6833c41bf1f215aa4bdcd7fbba1.png" width="1737" height="632" class="img_ev3q"></p>
<p>As such, I wrote the following code to take the input from xinput and convert that to the key pressed:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#!/usr/bin/env python3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shift </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">9</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#The number from the key code to reflect the scan code; scancode hex decimal + 9 = xinput_code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#Hex value for scan code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">scancode_hex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x5&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x6&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x7&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x9&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xa&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xb&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xc&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xd&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xe&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xf&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x10&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x11&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x12&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x13&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x14&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x15&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x16&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x17&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x18&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x19&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1a&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1b&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1c&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1d&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1e&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x1f&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x20&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x21&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x22&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x23&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x24&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x25&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x26&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x27&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x28&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x29&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2a&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2b&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2c&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2d&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2e&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x2f&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x30&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x31&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x32&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x33&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x34&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x35&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x36&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x37&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x38&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x39&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3a&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3b&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3c&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3d&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3e&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x3f&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x40&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x41&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x42&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x43&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x44&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x45&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x46&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x47&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x48&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x49&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4a&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4b&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4c&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4d&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4e&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x4f&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x50&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x51&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x52&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x53&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x54&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x56&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#Keycode that aligns with the Hex value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">US_keycap </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Esc&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1 or !&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2 or @&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3 or #&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;4 or $&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;5 or %&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;6 or ^&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;7 or &amp;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;8 or *&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;9 or (&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0 or )&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;- or _&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;= or +&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Backspace&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tab&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Q&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;W&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;E&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;R&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;T&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Y&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;U&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;I&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;O&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;P&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[ or {&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;] or }&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Enter&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Left Control&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;A&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;S&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;D&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;G&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;H&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;J&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;K&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;L&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;; or :&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&#x27; or &quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;` or ~&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Left Shift&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;\\ or |&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Z&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;C&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;V&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;B&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;N&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;M&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;, or &lt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;. or &gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/ or ?&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Right Shift&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-* or */Print Screen&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Left Alt&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Space Bar&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Caps Lock&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F3&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F4&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F5&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F6&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F7&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F9&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;F10&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NumLock&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Scroll Lock&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-7/Home&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-8/Up&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-9/PgUp&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad--&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-4/Left&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-5&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-6/Right&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-+&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-0/Ins&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Keypad-./Del&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Alt-SysRq&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Windows Key&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Hex will align with the decimal version of what sudo showkey --showcodes was outputting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#Whatever number xinput outputs when it says key press or release</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">xinput_code </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">13</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">14</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">15</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">17</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">18</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">19</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">21</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">22</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">23</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">24</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">25</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">26</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">27</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">28</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">29</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">31</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">33</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">34</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">36</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">37</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">38</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">39</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">41</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">42</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">43</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">44</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">45</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">46</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">47</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">48</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">49</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">51</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">52</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">53</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">54</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">55</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">56</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">57</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">58</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">59</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">61</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">62</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">63</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">65</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">66</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">67</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">68</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">69</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">70</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">71</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">72</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">73</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">74</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">75</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">76</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">77</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">78</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">79</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">81</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">82</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">83</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">84</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">85</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">86</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">87</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">88</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">89</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">90</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">91</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">92</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">94</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">scancode_hex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> US_keycap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> xinput_code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#print(data) #if you wanted side by side</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hex_to_dec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hexadecimal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hexadecimal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">xinput_modification</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#regex to get xinput number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reg </span><span class="token operator">=</span><span class="token plain"> re</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">compile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;key release|press (.*)&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#change 8 to keyboard number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    proc </span><span class="token operator">=</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Popen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;xinput&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;8&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">stdout</span><span class="token operator">=</span><span class="token plain">subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        line </span><span class="token operator">=</span><span class="token plain"> proc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">stdout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">readline</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bytes_to_hex </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;utf-8&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> output </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> reg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">findall</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bytes_to_hex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            clean_data </span><span class="token operator">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> output </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> output </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> xinput_code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">US_keycap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">-</span><span class="token plain">shift</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">xinput_modification</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>NOTE</strong>: The aforementioned code can modified as a remote keylogger running constantly in the background (using cron) and sending inputs to a remote webhook or C2 server, but that is out of scope of this blog.</p>
<p>Output of the code:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-11_16-13-909a5c8a93020159f058ef4e2eb0c860.png" width="1766" height="829" class="img_ev3q"></p>
<p>While typing as the root user into a root-readable file, the xinput is able to pickup all of the keyboard presses, since both windows are using the same X.org server.</p>
<p>The user-level user is also able to screenshot the desktop as well, including apps being run by the root user as well. You can run the <code>xwd -display &quot;${DISPLAY}&quot; -root | convert xwd:- screen.png</code> command <strong>as user</strong> to test this out [1]:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-11_16-14-a8a108f94254ae718d5b8e816bf5a012.png" width="1628" height="868" class="img_ev3q"></p>
<p>You might also be able to grab the string on the clipboard as well, per: <a href="https://unix.stackexchange.com/questions/188977/operate-x-clipboard-from-command-line" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/questions/188977/operate-x-clipboard-from-command-line</a>. This would come in handy for grabbing passwords from a user who uses a password manager.</p>
<p>These are just a couple examples of what this vulnerability can lead to. Now, let&#x27;s look into Flatpak and Snappy to see how they implement sandboxing.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flatpak">Flatpak<a href="#flatpak" class="hash-link" aria-label="Direct link to Flatpak" title="Direct link to Flatpak">​</a></h2>
<p>Flatpak is a package manager that allows for easy installation of apps on Linux. For example, installing Flatpak and a Flatpak application is as easy as the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> flatpak </span><span class="token comment" style="color:rgb(98, 114, 164)">#Install flatpak app</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> gnome-software-plugin-flatpak </span><span class="token comment" style="color:rgb(98, 114, 164)">#Install plugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo </span><span class="token comment" style="color:rgb(98, 114, 164)">#Add repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Restart system here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatpak </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> flathub org.mozilla.firefox </span><span class="token comment" style="color:rgb(98, 114, 164)">#Install Firefox</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That&#x27;s all it takes. For updates, it&#x27;s as simple as a <code>flatpak update -y</code> (<code>-y</code> = Automatically answer yes to all questions (or pick the most prioritized answer)). We will get to why the <code>-y</code> would not be considered a good practice soon. On the <a href="https://docs.flatpak.org/en/latest/introduction.html" target="_blank" rel="noopener noreferrer">Flatpak documentation</a>, they claim one of the reasons to use Flatpak is its sandboxing:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;Sandboxed applications: one of Flatpak’s main goals is to increase the security of desktop systems by isolating applications from one another. This is achieved using sandboxing and means that, by default, applications that are run with Flatpak have limited access to the host environment.&quot; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Source: https://docs.flatpak.org/en/latest/introduction.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s dive a bit deeper into what sandboxing looks like for Flatpak applications. Based on the documentation, they are using bubblewrap and cgroups, which sounds correct when compared to what I have read in <a href="https://www.packtpub.com/en-us/product/mastering-linux-security-and-hardening-9781837630516" target="_blank" rel="noopener noreferrer">Mastering Linux Security</a> [10]. Bubblewrap is a &quot;tool for constructing sandbox environments&quot; [11]. &quot;bubblewrap works by creating a new, completely empty, mount namespace where the root is on a tmpfs that is invisible from the host, and will be automatically cleaned up when the last process exits. You can then use commandline options to construct the root filesystem and process environment and command to run in the namespace&quot; [11]. This implementation of sandboxing is much better than firejail (we will touch on this later). cgroups on the other hand, allow processes to run in their own kernel space and memory space allowing for segmentation [12]. This can also be used to limit resources a process can use [12]. Both of these tools come together to create a good environment to sandbox applications. However, the implementation of Flatpak itself, is where the sandboxing starts to fall apart.</p>
<p>Reading <a href="https://madaidans-insecurities.github.io/linux.html#flatpak" target="_blank" rel="noopener noreferrer">https://madaidans-insecurities.github.io/linux.html#flatpak</a> led me to have a different view on Flatpak. Personally, I never thought too much about the permissions on Flatpak applications, since I assumed it was in some sort of general Flatpak guidelines. It turns out that each application creator can set the permissions and those are the defaults you end up using. This can lead to an app owner choosing more than they need, such as a calculator asking for network access. Let&#x27;s look at <a href="https://flathub.org/apps/org.gnome.gitlab.somas.Apostrophe" target="_blank" rel="noopener noreferrer">https://flathub.org/apps/org.gnome.gitlab.somas.Apostrophe</a> for example:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-12_13-59-2af72a2c85539f56f845f1887bd9ff33.png" width="1399" height="942" class="img_ev3q"></p>
<p>There is no need for a local Markdown application to have access to the network. Just to be sure, I downloaded the app and checked if any aspect of it needed network access...it did not.</p>
<p>In addition, the Flatpak application has access to read all files on the system. This reminds me of an XKCD comic that works well as an example for this:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/authorization-30596da9b24f1f262dc4a43ebdc6d219.png" width="316" height="342" class="img_ev3q"></p>
<p>This is why application confinement is important to me. I want to make sure applications have the exact access they need for them to work; no more, no less. There are a couple of solutions to harden your Flatpaks: <a href="https://www.systutorials.com/docs/linux/man/1-flatpak-override/" target="_blank" rel="noopener noreferrer">flatpak-override</a> and <a href="https://github.com/tchx84/Flatseal" target="_blank" rel="noopener noreferrer">flatseal</a> [19,20]. With <code>flatpak override</code>, this is done through the command line, while Flatseal is a GUI for this; Both reference the same permissions. See the following image of Flatseal:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-12_15-15-fabbb421f4e4eced310975de7e9620eb.png" width="1034" height="928" class="img_ev3q"></p>
<p>The post at <a href="https://privsec.dev/posts/linux/desktop-linux-hardening/#flatpak" target="_blank" rel="noopener noreferrer">https://privsec.dev/posts/linux/desktop-linux-hardening/#flatpak </a>does have recommendations for what to run as a &quot;privacy/security&quot; baseline:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">For system:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> flatpak override </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--system</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">x11 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">fallback-x11 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">pulseaudio </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">session-bus </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">system-bus </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--unshare</span><span class="token operator">=</span><span class="token plain">network </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--unshare</span><span class="token operator">=</span><span class="token plain">ipc </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nofilesystem</span><span class="token operator">=</span><span class="token plain">host:reset </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nodevice</span><span class="token operator">=</span><span class="token plain">input </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nodevice</span><span class="token operator">=</span><span class="token plain">shm </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nodevice</span><span class="token operator">=</span><span class="token plain">all --no-talk-name</span><span class="token operator">=</span><span class="token plain">org.freedesktop.Flatpak --no-talk-name</span><span class="token operator">=</span><span class="token plain">org.freedesktop.systemd1 --no-talk-name</span><span class="token operator">=</span><span class="token plain">ca.desrt.dconf --no-talk-name</span><span class="token operator">=</span><span class="token plain">org.gnome.Shell.Extensions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">For user:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatpak override </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--user</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">x11 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">fallback-x11 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">pulseaudio </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">session-bus </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nosocket</span><span class="token operator">=</span><span class="token plain">system-bus </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--unshare</span><span class="token operator">=</span><span class="token plain">network </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--unshare</span><span class="token operator">=</span><span class="token plain">ipc </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nofilesystem</span><span class="token operator">=</span><span class="token plain">host:reset </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nodevice</span><span class="token operator">=</span><span class="token plain">input </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nodevice</span><span class="token operator">=</span><span class="token plain">shm </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--nodevice</span><span class="token operator">=</span><span class="token plain">all --no-talk-name</span><span class="token operator">=</span><span class="token plain">org.freedesktop.Flatpak --no-talk-name</span><span class="token operator">=</span><span class="token plain">org.freedesktop.systemd1 --no-talk-name</span><span class="token operator">=</span><span class="token plain">ca.desrt.dconf --no-talk-name</span><span class="token operator">=</span><span class="token plain">org.gnome.Shell.Extensions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After running this, you can choose to override the overrides by going on an app-by-app basis and changing what permissions need to be modified [20]:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatpak </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--user</span><span class="token plain"> override com.github.tchx84.Flatseal </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--filesystem</span><span class="token operator">=</span><span class="token plain">/var/lib/flatpak/app:ro </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--filesystem</span><span class="token operator">=</span><span class="token plain">xdg-data/flatpak/app:ro </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--filesystem</span><span class="token operator">=</span><span class="token plain">xdg-data/flatpak/overrides:create</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I did want to mention something here, something I dealt with, but didn&#x27;t put two and two together until reading the following on <a href="https://privsec.dev/posts/linux/desktop-linux-hardening/#flatpak" target="_blank" rel="noopener noreferrer">https://privsec.dev/posts/linux/desktop-linux-hardening/#flatpak</a>: &quot;If you or a Flatpak frontend (app store) simply executes <code>flatpak update -y</code>, Flatpaks will be automatically granted any new permissions declared upstream without notifying you&quot; [20]. I did notice this when I update with the <code>-y</code> argument, as well. I usually run the <code>sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; flatpak update -y</code> command to update everything in one run, but I plan to change this strategy going forward.</p>
<p>My recommendation for this would be to audit all Flatpak applications you have. Run the general overrides first. Then slowly give the permissions that the application needs to work. For file-related permissions, I would recommend having a specific directory assigned just for your interaction with Flatpak. This directory would be where you put files that you want Flatpak applications to be able to access. You can then update <code>--filesystem=host</code> to the location you created. I would also recommend using the &quot;<!-- -->:ro<!-- -->&quot; suffix to make sure the permission is for read-only (unless you need it to output files as well)[21]. Some applications implement the <a href="https://docs.flatpak.org/en/latest/portal-api-reference.html" target="_blank" rel="noopener noreferrer">Portal API</a>, which allows a file manager to pass files to the Flatpak application (e.g. VLC) without specific filesystem access privileges. Despite this, many of them <a href="https://github.com/flathub/org.videolan.VLC/blob/master/org.videolan.VLC.yaml" target="_blank" rel="noopener noreferrer">still declare</a> --filesystem=host&quot;[20].</p>
<p>You could possibly have a bash file that has your flatpak override commands for all your applications in it. Then you can run that in one command with <code>flatpak -y</code>, as such: <code>sudo apt update -y &amp;&amp; sudo apt upgrade -y &amp;&amp; flatpak update -y &amp;&amp; bash script.sh</code>. This way the permissions will not be changed across updates automatically, and you are still able to update everything in one run. However, this might be a bit more complicated than just using Flatseal.</p>
<p>These were the main topics I wanted to mention regarding Flatpak applications. Now let&#x27;s move to see how Snappy deals with sandboxing.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="snappy">Snappy<a href="#snappy" class="hash-link" aria-label="Direct link to Snappy" title="Direct link to Snappy">​</a></h2>
<p>&quot;Ubuntu’s Snappy system, which allows developers to create snap packages that are supposed to run on any system on which the Snappy system can be installed. Each snap application runs in its own isolated sandbox, which helps protect the system from malicious programs. Each snap package is a self-contained unit, which means you don’t have to worry about installing dependencies. You can even create snap packages for servers that contain multiple services. The snapd daemon constantly runs in the background, automatically updating both itself and any installed snap applications.&quot; [12]. There are 3 main parts to the Snappy system for a desktop user: the snap application, the snap daemon, and the Snap Store [12,22]. For the sake of this blog, we will only focus on the snap applications and the sandboxing and permissions related to it.</p>
<p>Snap applications use &quot;a combination of AppArmor, seccomp, mount namespaces, cgroups and traditional UNIX permissions. To then allow a package access to common resources, the snap system provides ‘interfaces’ to which packages can be granted access as required or determined by the user&quot; [23]. SECCOMP, or seccomp, &quot;allows a process to make a one-way transition into a &quot;secure&quot; state where it cannot make any system calls except exit(), sigreturn(), read() and write() to already-open file descriptors. Should it attempt any other system calls, the kernel will either just log the event or terminate the process with SIGKILL or SIGSYS. In this sense, it does not virtualize the system&#x27;s resources but isolates the process from them entirely&quot; [27].</p>
<p>Ubuntu does have documentation that goes a bit deeper into these security technologies here: <a href="https://ubuntu.com/core/docs/security-and-sandboxing" target="_blank" rel="noopener noreferrer">https://ubuntu.com/core/docs/security-and-sandboxing</a>. There are two modes of snap confinement for applications: strict and classic [7,24]:</p>
<p><strong>Strict</strong> Used by the majority of snaps. Strictly confined snaps run in complete isolation, up to a minimal access level that’s deemed always safe. Consequently, strictly confined snaps can not access files, network, processes or any other system resource without requesting specific access via an interface (see below).</p>
<p><strong>Classic</strong> Allows access to the system’s resources in much the same way traditional packages do. To safeguard against abuse, publishing a classic snap requires manual approval, and installation requires the --classic command line argument.</p>
<p>In order to see what confinement is turned on, you have to verify this on an app by app basis. For Postman, it would be: <code>snap info --verbose postman | grep &quot;confinement\|devmode&quot;</code> [24]. The <code>devmode</code> is not needed, but it reflected what was in the Ubuntu documentation, so I kept it. The confinement on Ubuntu-based distributions is &quot;strict&quot;, while for other distributions it would be &quot;classic&quot; by default [7]. Of course, if you wanted a list of all of them at once, you could run a loop that runs through the list. It would look something along the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/usr/bin/env bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:rgb(189, 147, 249);font-style:italic">application</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">snap list </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--all</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">awk</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">sed</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;s/Name//g&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">sort</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-u</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;------------------------------------&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Confinement status for </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$application</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    snap info </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--verbose</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$application</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;confinement\|devmode&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;------------------------------------&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you have classic confinement, you will have to modify a kernel permission to get your snap to strict confinement, that being: <code>systemd.unified_cgroup_hierarchy=0</code> [7]. If you are not using an Ubuntu or one of its derivatives, I would just recommend not using Snappy at all, and instead try to find an alternate way to download the application. You will have better options to sandbox than classic confinement: such as Bubblejail or a MAC like AppArmor or SELinux.</p>
<p>If you do want to control the permissions your app has, you can do this via two methods: Snap Store (<a href="https://snapcraft.io/snap-store" target="_blank" rel="noopener noreferrer">https://snapcraft.io/snap-store</a>) or the command line [23]. The Snap Store has toggles for application permissions which make it easy to work with:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-14_15-34-ac26ef853d284b4166e67a7a4181bb93.png" width="298" height="133" class="img_ev3q"></p>
<p>The command line would show you similar information as well. For that you would run <code>snap interfaces application_name</code> or <code>snap connections application_name</code>[23,25]. If you wanted to manually append or remove permissions, you can do that with <code>snap connect snap_application:plug_interface</code> (ex. connecting VLC to the audio-record plug: <code>sudo snap connect vlc:audio-record</code>) [26]. For the previous example, you would replace &quot;connect&quot; with &quot;disconnect&quot;, so <code>sudo snap disconnect vlc:audio-record</code> [26].</p>
<p>One thing to mention here, is that the source code for the Snappy application server is not open source [12]. This can lead Ubuntu in the future to potentially add advertisements in Snap applications for Ubuntu Pro (as they already are in apt updates) or put third party ads (as they did in Ubuntu 12 (read more here: <a href="https://www.eff.org/deeplinks/2012/10/privacy-ubuntu-1210-amazon-ads-and-data-leaks" target="_blank" rel="noopener noreferrer">https://www.eff.org/deeplinks/2012/10/privacy-ubuntu-1210-amazon-ads-and-data-leaks</a>)).</p>
<p>With that being said, that pretty much covers what I wanted to discuss for Snappy. Holistically, the strict confinement is ideal for what I am looking for. However, the non-open-source nature of the distribution method, Snappy application server, make me a bit hesitant to hedge all my bets on Snappy. I plan to use Snappy when other options are not sufficient for me to use, and instead try to use the built-in package manager to download applications.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="firejail">Firejail<a href="#firejail" class="hash-link" aria-label="Direct link to Firejail" title="Direct link to Firejail">​</a></h2>
<p>&quot;Firejail uses namespaces, SECCOMP, and kernel capabilities to run untrusted applications in their own individual sandboxes. This can help prevent data leakage between applications, and it can help prevent malicious programs from damaging your system&quot; [12]. I did define seccomp before for Snap applications, but I will mention a concise summary just as a reminder: It limits the system calls (syscalls) a program can make to only the following: &quot;exit(), sigreturn(), read() and write() to already-open file descriptors&quot; [27]. This prevents the program from getting access to more syscalls then it would need to work. While doing research into this, it seems that Firejail not only uses seccomp, but seccomp-bpf. &quot;seccomp-bpf is an extension to seccomp that allows filtering of system calls using a configurable policy implemented using Berkeley Packet Filter rules&quot; [27,28]. &quot;The Berkeley Packet Filter (BPF; also BSD Packet Filter, classic BPF or cBPF) is a network tap and packet filter which permits computer network packets to be captured and filtered at the operating system level. It provides a raw interface to data link layers, permitting raw link-layer packets to be sent and received, and allows a userspace process to supply a filter program that specifies which packets it wants to receive&quot; [29].</p>
<p>Now that the technical deep-end information has been covered, let&#x27;s get into how to use it. Firejail can be downloaded using your system package manager (apt, yum, dnf, etc.), through the GitHub page (<a href="https://github.com/netblue30/firejail" target="_blank" rel="noopener noreferrer">https://github.com/netblue30/firejail</a>), or through the SourceForge page (<a href="https://sourceforge.net/projects/firejail/files/firejail/" target="_blank" rel="noopener noreferrer">https://sourceforge.net/projects/firejail/files/firejail/</a>). This would be a simple <code>sudo apt install firejail</code> on a Debian/Ubuntu-derived OS. Using Firejail is really easy, as it comes built in with pre-built profiles for popular applications (I currently see 1150, with <code>ls /etc/firejail/ | grep &quot;.profile$&quot; | wc -l</code>). Let&#x27;s &quot;firejail&quot; our first application: the Firefox browser. The basic command is simple: <code>firejail firefox</code>. This will look in the /etc/firejail/ directory to see if there is a profile for this, then load that profile into Firejail.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-15_11-30-212459900629958104f32f8d968cc574.png" width="1906" height="879" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">unix  2      [ ACC ]     STREAM     LISTENING     14264    /tmp/.X11-unix/X1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unix  2      [ ACC ]     STREAM     LISTENING     14263    @/tmp/.X11-unix/X1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means that there are two sockets are currently running on the X11 server [30]. The X1 mentioned in the output is a where the jail &quot;connects to the X11 server hosting the GNOME desktop itself...it is the &#x27;outer&#x27; (aka &#x27;host&#x27;) X11 server in this case&quot; [1]. The &quot;@&quot; in front of the second socket means that it is an abstract socket, &quot;which is independent of the filesystem&quot; [31]. According to the Firejail docs, &quot;The only way to disable the abstract socket @/tmp/.X11-unix/X0 is by using a network namespace. If for any reasons you cannot use a network namespace, the abstract socket will still be visible inside the sandbox. Hackers can attach keylogger and screenshot programs to this socket.&quot; This is essentially saying that we are still vulnerable to the X11 GUI vulnerability. Let&#x27;s mitigate this by using arguments on Firejail to harden this a bit. I will reference <a href="https://wiki.gentoo.org/wiki/User:Sakaki/Sakaki&#x27;s_EFI_Install_Guide/Sandboxing_the_Firefox_Browser_with_Firejail#Demonstrating_the_X11_Vulnerability" target="_blank" rel="noopener noreferrer">Sakaki&#x27;s guide</a> here mostly. It is a great resource, so I would recommend checking it out if you want an in-depth look into Firejail. First let&#x27;s look at the &quot;--x11=&quot; argument. There are 4 options for this argument: Xorg, Xephyr, Xpra, and Xvfb. Xephyr and Xpra are the main arguments mentioned in the Firejail documentation, so I will focus on those. I was able to find a good explanation comparing the two online [32]:</p>
<p>&quot; Xephyr is a nested X server displaying its root window (the desktop) inside an X window; Xpra is the X equivalent of screen or tmux, providing a virtual X environment and the ability to display the desktop or individual application windows locally or remotely, attaching and detaching as necessary.</p>
<p>Xpra can also forward audio, the clipboard and printing services. It provides nested X, but as a subset of everything it can do. &quot;</p>
<p>In addition, the Firejail documentation does mention that Xpra is forwarding X11 applications, while Xephyr is an X server itself [30]. Similar to Sakaki, I do believe that Xephyr is the solution we need for our use.</p>
<p>Straight out of the gate, with Xephyr, we can see a difference in socket name. Running <code>firejail --x11=xephyr --xephyr-screen=854x480 firefox</code>, we now see a change:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">unix  2      [ ACC ]     STREAM     LISTENING     44486    /tmp/.X11-unix/X130</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unix  2      [ ACC ]     STREAM     LISTENING     14264    /tmp/.X11-unix/X1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unix  2      [ ACC ]     STREAM     LISTENING     44485    @/tmp/.X11-unix/X130</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unix  2      [ ACC ]     STREAM     LISTENING     14263    @/tmp/.X11-unix/X1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The X130 socket is what Firefox now has access to as well:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-15_12-05-a17dec6ac4e0aa707adf83a515d8749f.png" width="1881" height="880" class="img_ev3q"></p>
<p>This is the X11 Xephyr server socket. However, just this change is not enough for GUI isolation. To fix this issue, we need to isolate the host X11 sockets by having them to have their own network namespace. &quot;Network namespaces: these enable containers to have their own network devices, IP addresses, ARP and routing tables, netfilter rules etc.: essentially an isolated network stack&quot; [1]. To do this, we just add an extra argument: &quot;--net=&quot;. These networks can be found by running <code>ip addr | grep -oP &#x27;\d:\s(\w+)&#x27; | awk &#x27;{print $2}&#x27;</code>, if your distribution supports the <code>ip addr</code> command. For my case, I only have two outputs: lo and enp1s0. Since lo is localhost, this won&#x27;t be able to help us a lot for this, as this is not the network interface the data is going out from. <strong>This will not work for a Wi-Fi interface [1].</strong> If you did want to get this running for a Wi-Fi interface, I would recommend checking out this section: <a href="https://wiki.gentoo.org/wiki/User:Sakaki/Sakaki&#x27;s_EFI_Install_Guide/Sandboxing_the_Firefox_Browser_with_Firejail#Comms_Isolation_via_Network_Namespaces" target="_blank" rel="noopener noreferrer">https://wiki.gentoo.org/wiki/User<!-- -->:Sakaki<!-- -->/Sakaki&#x27;s_EFI_Install_Guide/Sandboxing_the_Firefox_Browser_with_Firejail#Comms_Isolation_via_Network_Namespaces</a></p>
<p>In order to prevent privilege escalation from an application, we need two arguments: <code>--caps.drop=all</code> and <code>--nonewprivs</code>. The first argument drops all capabilities and &quot;causes subsequent attempts by the process (or its children) to load kernel modules, escalate privileges, replace the kernel, restart the system etc. to be rejected&quot; [1]. The second argument &quot;prevents any privilege escalation via execve; it is automatically set if a seccomp-bpf filter is in use, and for avoidance of doubt is explicitly set by firejail&#x27;s default firefox profile too&quot; [1].</p>
<p>Combining all of these arguments gets us the following: <code>firejail --x11=xephyr --xephyr-screen=854x480 --net=enp1s0 --caps.drop=all --nonewprivs application_name</code>. Running a version of this command showed an error:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-15_14-23-c7a99aa2dc87deb14680c55aec1ec7b9.png" width="813" height="200" class="img_ev3q"></p>
<p>There was an issue created for this on GitHub already (<a href="https://github.com/netblue30/firejail/issues/2638" target="_blank" rel="noopener noreferrer">https://github.com/netblue30/firejail/issues/2638</a>), so I used the solution here to get it working. I tried updating just the Firefox Firejail profile by disabling the &quot;netfilter&quot; setting, but that did not change anything. After I changed &quot;restricted-network yes&quot; to &quot;restricted-network no&quot; in <code>/etc/firejail/firejail.config</code>, I was able to get Firefox working.</p>
<p>You can spend hours building specific profiles per application. For Firefox, I was able to find a reasonable command online: <code>firejail --noprofile --nogroups --private=~/firejail/ --private-dev --private-tmp --ipc-namespace --machine-id --noroot --caps.drop=all --seccomp --debug --trace --nosound --no3d firefox --new-instance</code> [33]. This does the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">--noprofile              #Disables the default profile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--nogroups               #Disable supplementary groups</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--private=~/firejail/    #Use directory as user home</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--private-dev            #Create a new /dev directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--private-tmp            #Create a new /tmp directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--ipc-namespace          #Enable a new IPC namespace if the sandbox was started as a regular user</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--machine-id             #Spoof id number in /etc/machine-id file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--noroot                 #Install  a user namespace with a single user - the current user</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--caps.drop=all          #Drop all capabilities for the processes running in the  sandbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--seccomp                #Enable seccomp filter and blacklist the syscalls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--debug                  #Print debug messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--trace                  #Trace  open,  access  and  connect  system calls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--nosound                #Disable sound system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--no3d                   #Disable 3D hardware acceleration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">firefox --new-instance   #Open new instance, not a new window in running instance.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I would of course tweak things to this for myself, such as add <code>--dns=address=9.9.9.9</code> (Quad9) and <code>--x11=xephyr</code> or some of the other options here: <a href="https://firejail.wordpress.com/documentation-2/firefox-guide/" target="_blank" rel="noopener noreferrer">https://firejail.wordpress.com/documentation-2/firefox-guide/</a>. I&#x27;ll definitely have to dedicate a session to figuring this out for each app I use Firejail with. If you like the configurations that come default with Firejail, you can run <code>sudo firecfg</code> and it will take the applications you have in /usr/local/bin/ and create a symbolic link to the profiles. This means you can run <code>firefox</code> on the command line and firefox will start up as if you typed <code>firejail firefox</code>. If you end up disliking it, you can just run <code>sudo firecfg --clean</code>, and it will remove the symbolic links. You can also convert a command and build a profile for yourself if you choose to as well. You can check out the documentation regarding this here: <a href="https://firejail.wordpress.com/documentation-2/building-custom-profiles/" target="_blank" rel="noopener noreferrer">https://firejail.wordpress.com/documentation-2/building-custom-profiles/</a>. You can also use firetools (<a href="https://github.com/netblue30/firetools" target="_blank" rel="noopener noreferrer">https://github.com/netblue30/firetools</a>), which is a Firejail GUI, to make creating profiles easier.</p>
<p>Firejail does do a good job in sandboxing a applications, but Firejail itself is not recommended by privacy professionals to use due to what it is: a large SUID binary. This allows Firejail to run with the privileges of the owner of the Firejail executable: root [34]. This means any vulnerability in Firejail can lead to privilege escalation on the system [34]. If you look at the CVEs for Firejail, there are 18 (as of writing this post): <a href="https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=firejail" target="_blank" rel="noopener noreferrer">https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=firejail</a>, with multiple of them being privilege escalation vulnerabilities [34].</p>
<p>Overall, Firejail is a pretty good tool to use for sandboxing and does allow one to customize it pretty well. However, if I can find an alternate in Bubblewrap, which is not using SUID to work, that would be ideal for me.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bubblewrap">Bubblewrap<a href="#bubblewrap" class="hash-link" aria-label="Direct link to Bubblewrap" title="Direct link to Bubblewrap">​</a></h2>
<p>After trying to get Bubblejail (a wrapper for Bubblewrap) to work (see: <a href="https://github.com/igo95862/bubblejail/issues/129" target="_blank" rel="noopener noreferrer">https://github.com/igo95862/bubblejail/issues/129</a>), I went to Bubblewrap directly to see how to set it up. Bubblewrap is a &quot;tool for constructing sandbox environments&quot; [11]. &quot;bubblewrap works by creating a new, completely empty, mount namespace where the root is on a tmpfs that is invisible from the host, and will be automatically cleaned up when the last process exits. You can then use commandline options to construct the root filesystem and process environment and command to run in the namespace&quot; [11].</p>
<p>Bubblewrap is a bit limited in terms of what it can sandbox and what it cannot. On the GitHub page, they mention: &quot;Firejail knows about Pulseaudio, whereas bubblewrap does not&quot; (Pulseaudio is a audio server on Linux) [35]. Bubblewrap also has the main namespaces as features for users to use as well [35]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">User namespaces (CLONE_NEWUSER): This hides all but the current uid and gid from the sandbox. You can also change what the value of uid/gid should be in the sandbox.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IPC namespaces (CLONE_NEWIPC): The sandbox will get its own copy of all the different forms of IPCs, like SysV shared memory and semaphores.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID namespaces (CLONE_NEWPID): The sandbox will not see any processes outside the sandbox. Additionally, bubblewrap will run a trivial pid1 inside your container to handle the requirements of reaping children in the sandbox. This avoids what is known now as the Docker pid 1 problem.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Network namespaces (CLONE_NEWNET): The sandbox will not see the network. Instead it will have its own network namespace with only a loopback device.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UTS namespace (CLONE_NEWUTS): The sandbox will have its own hostname.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Seccomp filters: You can pass in seccomp filters that limit which syscalls can be done in the sandbox. For more information, see Seccomp.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s jump into how to create a command/script/profile for each application we plan to sandbox. The Bubblewrap documentation was pretty dry for me, so I was able to piece together what I needed from the following sources, which I will mainly reference going forward (I will cite other sources if I use them, but not the following for this section going forward):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://regginator729.wordpress.com/2017/12/12/using-bubblewrap-as-sandbox/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://misile00.github.io/notes/Bubblewrap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://wiki.archlinux.org/title/Bubblewrap/Examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://sloonz.github.io/posts/sandboxing-1/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On first glance, one thing I noticed in the Bubblewrap man page is that it did not have a way to add a DNS setting to the sandbox, as Firejail has <code>--dns=address</code>. My assumption is that this would man that the DNS it uses is the DNS the system uses. For now, let&#x27;s discuss building up a Bubblewrap &quot;profile&quot; by using parameters. There are a lot of parameters, and those can be seen by doing a <code>bwrap --help</code>. I see 55 parameters (excluding &quot;--help&quot;). In addition, similar to <a href="https://regginator729.wordpress.com/2017/12/12/using-bubblewrap-as-sandbox/" target="_blank" rel="noopener noreferrer">https://regginator729.wordpress.com/2017/12/12/using-bubblewrap-as-sandbox/</a>, I will be slowly adding up and building up parameters for Bubblewrap until it feels sufficient for me.</p>
<p>I started off by giving the app read-only permission on my system. In addition, clear out the environment variables (this leaks information about your configuration and system - we can add variables as needed):</p>
<p><code>bwrap --ro-bind / / --clearenv bash</code></p>
<p>We can see this working already:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-16_14-23-f688d36de7cc804265a5a8406e5372c7.png" width="780" height="861" class="img_ev3q"></p>
<p>We can then change the local /tmp directory to be the $HOME directory of the sandboxed application:</p>
<p><code>bwrap --ro-bind / / --bind /tmp $HOME --clearenv bash</code></p>
<p>NOTE: If you get the <code>bwrap: execvp bash: No such file or directory</code> error, you will have to run <code>ldd $(which bash)</code> (replace bash with application name) to find out the libraries that bash uses. From there, you can &quot;import&quot; those libraries into the bubblewrap command (ex. <code>bwrap --ro-bind /usr /usr --ro-bind /bin /bin --ro-bind /lib /lib --ro-bind /lib64 /lib64 --ro-bind /sbin /sbin --ro-bind /etc /etc bash</code>).</p>
<p>Let&#x27;s unshare the user and unshare the network:</p>
<p><code>bwrap --ro-bind / / --bind /tmp $HOME --clearenv --unshare-net --unshare-user bash</code></p>
<p>For some reason the network was unshared, but the user was not shared initially anyway, thus no &quot;unshare&quot;. I kept this command either way.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-16_15-13-a2c03e12abd955c62789a89e2e8c55fb.png" width="1040" height="387" class="img_ev3q"></p>
<p>We can add a hostname here as well. This can prevent us &quot;leaking&quot; the Operating system we are using:</p>
<p><code>bwrap --ro-bind / / --bind /tmp $HOME --clearenv --unshare-net --unshare-user --hostname hostname --unshare-uts bash</code></p>
<p>The <code>--hostname</code> parameter needs <code>--unshare-uts</code> to work, so that was added as well.</p>
<p>Finally, lets add the following:</p>
<ol>
<li>a devtmpfs file system (<code>--dev /dev</code>)</li>
<li>temporary /var folder (<code>--tmpfs /var</code>)</li>
<li>an isolated /proc folder for processed (<code>--proc /proc</code>)</li>
<li>temporary $HOME (<code>--tmpfs $HOME</code>)</li>
<li>unshare PIDs so sandbox can&#x27;t see apps outside of sandbox (<code>--unshare-pid</code>)</li>
</ol>
<p>Adding all this, we have the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bwrap --ro-bind / / --bind /tmp $HOME --clearenv --unshare-net --unshare-user --hostname hostname --unshare-uts --unshare-pid --dev /dev --tmpfs /var --proc /proc --tmpfs $HOME bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Screenshot_2024-09-16_15-39-e44a9ef755fd31e8ccc36cd697f60a0c.png" width="1045" height="369" class="img_ev3q"></p>
<p>We can convert this into a script to make it easy to make changes and to use as a default &quot;profile&quot; when using other applications with Bubblewrap as well. This is easily done by adding a <code>\</code> after each parameter:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#/usr/bin/env bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bwrap </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--ro-bind / / </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bind</span><span class="token plain"> /tmp </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$HOME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--clearenv</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--unshare-net </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--unshare-user </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hostname</span><span class="token plain"> --unshare-uts </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--unshare-pid </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--dev</span><span class="token plain"> /dev </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--tmpfs</span><span class="token plain"> /var </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--proc</span><span class="token plain"> /proc </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--tmpfs</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$HOME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$@</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The &quot;$@&quot; at the end refers to the command <strong>and its arguments</strong>. If you just wanted to get the command only, then it would be &quot;$1&quot;.</p>
<p>You can go really in-depth with this and get to seirdy&#x27;s level: <a href="https://git.sr.ht/~seirdy/bwrap-scripts/tree/trunk/item/firefox-sandbox" target="_blank" rel="noopener noreferrer">https://git.sr.ht/~seirdy/bwrap-scripts/tree/trunk/item/firefox-sandbox</a>. madaidan summarizes the situation well: &quot;Unfortunately, bubblewrap isn&#x27;t very widespread and can be difficult to learn. Bubblewrap is essentially a bare bones wrappers around namespaces and seccomp. A user would need decent knowledge on how the filesystem, syscalls and so on work to properly use it&quot; [34]. In addition, on Bubblewraps README.md, it says &quot;bubblewrap is a tool for constructing sandbox environments. bubblewrap is not a complete, ready-made sandbox with a specific security policy&quot; [35].</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="firejail-vs-bubblewrap">Firejail vs. Bubblewrap<a href="#firejail-vs-bubblewrap" class="hash-link" aria-label="Direct link to Firejail vs. Bubblewrap" title="Direct link to Firejail vs. Bubblewrap">​</a></h2>
<p>From a security perspective, Bubblewrap seems to be the obvious choice due to the smaller attack surface (SUID configuration). However, due to its higher learning curve, it puts some people off who would like to leverage sandboxing applications. I did come across <a href="https://wiki.archlinux.org/title/Bubblewrap#Using_X11" target="_blank" rel="noopener noreferrer">https://wiki.archlinux.org/title/Bubblewrap#Using_X11</a> during my research, where X11 gets brought up. With Firejail, I had the in-built option to use Xephyr to prevent the user&#x27;s socket to be accessible by the sandbox. This is not a built in feature in Bubblewrap, but can be integrated externally (yet another thing you will have to configure yourself). There is a good summary at the bottom of <a href="https://hkubota.wordpress.com/2020/12/31/comparing-sandboxing-tools/" target="_blank" rel="noopener noreferrer">https://hkubota.wordpress.com/2020/12/31/comparing-sandboxing-tools/</a> as well, comparing these solutions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="firejail-and-bubblewrap-learning-curve">Firejail and Bubblewrap Learning Curve<a href="#firejail-and-bubblewrap-learning-curve" class="hash-link" aria-label="Direct link to Firejail and Bubblewrap Learning Curve" title="Direct link to Firejail and Bubblewrap Learning Curve">​</a></h2>
<p>After trying to play around and create profiles for both Firejail and Bubblewrap, I understood the difficulty in creating a custom profile. In order to do this, you need to learn about D-Bus, and also have knowledge about X11 vs. Wayland, PCI devices, etc. In addition, in order to make sure the permissions are not too granular or too permissive you have to read each line to make sure it is perfect for your use case. Even with <code>firejail --build=application_name.profile application</code>, you have a profile <strong>which is not usable out of the gate.</strong> Using the output of syslog and other system log files, and then appending to a firejail/Bubblewrap profile, is not ideal in my opinion for even technical users. To clarify, I am not asking for a perfect out of the box software; I am just asking for a solution that makes sandboxing just a bit easier to understand and maintain out of the box.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-takeaways">Key Takeaways<a href="#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways">​</a></h2>
<ol>
<li>I need to switch to Wayland to mitigate the X11 vulnerability, as the sandboxing solutions did not pan out as expected</li>
<li>I need to run <code>flatpak update</code> instead of <code>flatpak update -y</code> to make sure I do not override any past permissions</li>
<li>While downloading a new Flatpak or Snappy app, I need to be cognizant of what permissions I allow it to have</li>
<li>Firejail and Bubblewrap (and even Bubblejail) need <strong>a lot</strong> of maintenance to create profiles. Doing this for every single application using these tools is not ideal</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sources">Sources<a href="#sources" class="hash-link" aria-label="Direct link to Sources" title="Direct link to Sources">​</a></h2>
<ol>
<li><a href="https://wiki.gentoo.org/wiki/User:Sakaki/Sakaki&#x27;s%5C_EFI%5C_Install%5C_Guide/Sandboxing%5C_the%5C_Firefox%5C_Browser%5C_with%5C_Firejail" target="_blank" rel="noopener noreferrer">https://wiki.gentoo.org/wiki/User:Sakaki/Sakaki&#x27;s\_EFI\_Install\_Guide/Sandboxing\_the\_Firefox\_Browser\_with\_Firejail</a></li>
<li><a href="https://security.stackexchange.com/questions/3589/passive-and-active-attacks-via-x11-is-wayland-any-better" target="_blank" rel="noopener noreferrer">https://security.stackexchange.com/questions/3589/passive-and-active-attacks-via-x11-is-wayland-any-better</a></li>
<li><a href="https://en.wikipedia.org/wiki/X.Org%5C_Server" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/X.Org\_Server</a></li>
<li><a href="https://theinvisiblethings.blogspot.com/2010/08/ms-dos-security-model.html" target="_blank" rel="noopener noreferrer">https://theinvisiblethings.blogspot.com/2010/08/ms-dos-security-model.html</a></li>
<li><a href="https://madaidans-insecurities.github.io/guides/linux-hardening.html" target="_blank" rel="noopener noreferrer">https://madaidans-insecurities.github.io/guides/linux-hardening.html</a></li>
<li><a href="https://unix.stackexchange.com/questions/345344/difference-between-xorg-and-gnome-kde-xfce" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/questions/345344/difference-between-xorg-and-gnome-kde-xfce</a></li>
<li><a href="https://privsec.dev/posts/linux/desktop-linux-hardening/" target="_blank" rel="noopener noreferrer">https://privsec.dev/posts/linux/desktop-linux-hardening/</a></li>
<li><a href="https://www.flatpak.org/setup/Debian" target="_blank" rel="noopener noreferrer">https://www.flatpak.org/setup/Debian</a></li>
<li><a href="https://docs.flatpak.org/en/latest/introduction.html" target="_blank" rel="noopener noreferrer">https://docs.flatpak.org/en/latest/introduction.html</a></li>
<li><a href="https://docs.flatpak.org/en/latest/under-the-hood.html" target="_blank" rel="noopener noreferrer">https://docs.flatpak.org/en/latest/under-the-hood.html</a></li>
<li><a href="https://github.com/containers/bubblewrap" target="_blank" rel="noopener noreferrer">https://github.com/containers/bubblewrap</a></li>
<li><a href="https://www.packtpub.com/en-us/product/mastering-linux-security-and-hardening-9781837630516" target="_blank" rel="noopener noreferrer">https://www.packtpub.com/en-us/product/mastering-linux-security-and-hardening-9781837630516</a></li>
<li><a href="https://www.win.tue.nl/%5C~aeb/linux/kbd/scancodes-1.html" target="_blank" rel="noopener noreferrer">https://www.win.tue.nl/\~aeb/linux/kbd/scancodes-1.html</a></li>
<li><a href="https://stackoverflow.com/questions/9210525/how-do-i-convert-hex-to-decimal-in-python" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/9210525/how-do-i-convert-hex-to-decimal-in-python</a></li>
<li><a href="https://www.geeksforgeeks.org/python-create-a-list-of-tuples/" target="_blank" rel="noopener noreferrer">https://www.geeksforgeeks.org/python-create-a-list-of-tuples/</a></li>
<li><a href="https://flatkill.org/" target="_blank" rel="noopener noreferrer">https://flatkill.org/</a></li>
<li><a href="https://flatkill.org/2020/" target="_blank" rel="noopener noreferrer">https://flatkill.org/2020/</a></li>
<li><a href="https://xkcd.com/1200/" target="_blank" rel="noopener noreferrer">https://xkcd.com/1200/</a></li>
<li><a href="https://tesk.page/2021/02/11/response-to-flatkill-org/" target="_blank" rel="noopener noreferrer">https://tesk.page/2021/02/11/response-to-flatkill-org/</a></li>
<li><a href="https://privsec.dev/posts/linux/desktop-linux-hardening/#flatpak" target="_blank" rel="noopener noreferrer">https://privsec.dev/posts/linux/desktop-linux-hardening/#flatpak</a></li>
<li><a href="https://man.archlinux.org/man/flatpak-override.1" target="_blank" rel="noopener noreferrer">https://man.archlinux.org/man/flatpak-override.1</a></li>
<li><a href="https://en.wikipedia.org/wiki/Snap%5C_(software)" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Snap\_(software)</a></li>
<li><a href="https://ubuntu.com/blog/a-guide-to-snap-permissions-and-interfaces" target="_blank" rel="noopener noreferrer">https://ubuntu.com/blog/a-guide-to-snap-permissions-and-interfaces</a></li>
<li><a href="https://snapcraft.io/docs/snap-confinement" target="_blank" rel="noopener noreferrer">https://snapcraft.io/docs/snap-confinement</a></li>
<li><a href="https://askubuntu.com/questions/1206951/how-can-snap-permissions-be-viewed-and-modified" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/1206951/how-can-snap-permissions-be-viewed-and-modified</a></li>
<li><a href="https://snapcraft.io/docs/interface-management" target="_blank" rel="noopener noreferrer">https://snapcraft.io/docs/interface-management</a></li>
<li><a href="https://en.wikipedia.org/wiki/Seccomp" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Seccomp</a></li>
<li><a href="https://github.com/netblue30/firejail" target="_blank" rel="noopener noreferrer">https://github.com/netblue30/firejail</a></li>
<li><a href="https://en.wikipedia.org/wiki/Berkeley%5C_Packet%5C_Filter" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Berkeley\_Packet\_Filter</a></li>
<li><a href="https://firejail.wordpress.com/documentation-2/x11-guide/" target="_blank" rel="noopener noreferrer">https://firejail.wordpress.com/documentation-2/x11-guide/</a></li>
<li><a href="https://www.man7.org/linux/man-pages/man7/unix.7.html" target="_blank" rel="noopener noreferrer">https://www.man7.org/linux/man-pages/man7/unix.7.html</a></li>
<li><a href="https://unix.stackexchange.com/questions/608203/whats-the-difference-between-xpra-and-xephyr" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/questions/608203/whats-the-difference-between-xpra-and-xephyr</a></li>
<li><a href="https://anyon3.github.io/firejail.html" target="_blank" rel="noopener noreferrer">https://anyon3.github.io/firejail.html</a></li>
<li><a href="https://madaidans-insecurities.github.io/linux.html" target="_blank" rel="noopener noreferrer">https://madaidans-insecurities.github.io/linux.html</a></li>
<li><a href="https://github.com/containers/bubblewrap" target="_blank" rel="noopener noreferrer">https://github.com/containers/bubblewrap</a></li>
<li><a href="https://github.com/igo95862/bubblejail" target="_blank" rel="noopener noreferrer">https://github.com/igo95862/bubblejail</a></li>
<li><a href="https://regginator729.wordpress.com/2017/12/12/using-bubblewrap-as-sandbox/" target="_blank" rel="noopener noreferrer">https://regginator729.wordpress.com/2017/12/12/using-bubblewrap-as-sandbox/</a></li>
<li><a href="https://misile00.github.io/notes/Bubblewrap" target="_blank" rel="noopener noreferrer">https://misile00.github.io/notes/Bubblewrap</a></li>
<li><a href="https://wiki.archlinux.org/title/Bubblewrap/Examples" target="_blank" rel="noopener noreferrer">https://wiki.archlinux.org/title/Bubblewrap/Examples</a></li>
<li><a href="https://sloonz.github.io/posts/sandboxing-1/" target="_blank" rel="noopener noreferrer">https://sloonz.github.io/posts/sandboxing-1/</a></li>
<li><a href="https://git.sr.ht/%5C~seirdy/bwrap-scripts/tree/trunk/item/firefox-sandbox" target="_blank" rel="noopener noreferrer">https://git.sr.ht/\~seirdy/bwrap-scripts/tree/trunk/item/firefox-sandbox</a></li>
<li><a href="https://wiki.archlinux.org/title/Firejail" target="_blank" rel="noopener noreferrer">https://wiki.archlinux.org/title/Firejail</a></li>
<li><a href="https://odysee.com/@netblue30:9/profiles:0" target="_blank" rel="noopener noreferrer">https://odysee.com/@netblue30:9/profiles:0</a></li>
<li><a href="https://firejail.wordpress.com/documentation-2/building-custom-profiles/" target="_blank" rel="noopener noreferrer">https://firejail.wordpress.com/documentation-2/building-custom-profiles/</a></li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/operations-security/basic-software-investigation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Basic Software Investigation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operations-security/apparmor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AppArmor</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#testing-environment" class="table-of-contents__link toc-highlight">Testing Environment</a></li><li><a href="#x11" class="table-of-contents__link toc-highlight">X11</a><ul><li><a href="#the-x11-gui-vulnerability" class="table-of-contents__link toc-highlight">The X11 GUI &quot;Vulnerability&quot;</a></li><li><a href="#x11-gui-vulnerability-exploit" class="table-of-contents__link toc-highlight">X11 GUI &quot;Vulnerability&quot; Exploit</a></li></ul></li><li><a href="#flatpak" class="table-of-contents__link toc-highlight">Flatpak</a></li><li><a href="#snappy" class="table-of-contents__link toc-highlight">Snappy</a></li><li><a href="#firejail" class="table-of-contents__link toc-highlight">Firejail</a></li><li><a href="#bubblewrap" class="table-of-contents__link toc-highlight">Bubblewrap</a></li><li><a href="#firejail-vs-bubblewrap" class="table-of-contents__link toc-highlight">Firejail vs. Bubblewrap</a></li><li><a href="#firejail-and-bubblewrap-learning-curve" class="table-of-contents__link toc-highlight">Firejail and Bubblewrap Learning Curve</a></li><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li><li><a href="#sources" class="table-of-contents__link toc-highlight">Sources</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"> <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="http://www.harisqazi.com">Portfolio</a> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="http://www.harisqazi.com">Haris Qazi</a> is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">Creative Commons Attribution 4.0 International<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt=""></a></p> </div></div></div></footer></div>
</body>
</html>